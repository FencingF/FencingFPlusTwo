package org.fenci.fencingfplus2.features.module.modules.exploit;

import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.client.entity.EntityPlayerSP;
import net.minecraft.entity.Entity;
import org.fenci.fencingfplus2.features.module.Module;
import org.fenci.fencingfplus2.setting.Setting;

public class NoPacketTP extends Module {
    public static final Setting<Integer> speed = new Setting<>("Speed", 0, 0, 36);
    private double posX;
    private double posY;
    private double posZ;
    private float pitch;
    private float yaw;
    private EntityOtherPlayerMP clonedPlayer;
    private boolean isRidingEntity;
    private Entity ridingEntity;

    public NoPacketTP() {
        super("NoPacketTP", "Lmfao idk", Category.Exploit);
    }

    public void onEnable() {
        if (NoPacketTP.mc.player != null) {
            boolean bl = this.isRidingEntity = NoPacketTP.mc.player.getRidingEntity() != null;
            if (NoPacketTP.mc.player.getRidingEntity() == null) {
                this.posX = NoPacketTP.mc.player.posX;
                this.posY = NoPacketTP.mc.player.posY;
                this.posZ = NoPacketTP.mc.player.posZ;
            } else {
                this.ridingEntity = NoPacketTP.mc.player.getRidingEntity();
                NoPacketTP.mc.player.dismountRidingEntity();
            }
            this.pitch = NoPacketTP.mc.player.rotationPitch;
            this.yaw = NoPacketTP.mc.player.rotationYaw;
            this.clonedPlayer = new EntityOtherPlayerMP(NoPacketTP.mc.world, mc.getSession().getProfile());
            this.clonedPlayer.copyLocationAndAnglesFrom(NoPacketTP.mc.player);
            this.clonedPlayer.rotationYawHead = NoPacketTP.mc.player.rotationYawHead;
            NoPacketTP.mc.world.addEntityToWorld(-100, this.clonedPlayer);
            NoPacketTP.mc.player.capabilities.setPlayerWalkSpeed(speed.getValue() * 100);
            NoPacketTP.mc.player.noClip = true;
        }
    }

    public void onDisable() {
        EntityPlayerSP localPlayer = NoPacketTP.mc.player;
        if (localPlayer != null) {
            NoPacketTP.mc.player.setPositionAndRotation(this.posX, this.posY, this.posZ, this.yaw, this.pitch);
            NoPacketTP.mc.world.removeEntityFromWorld(-100);
            this.clonedPlayer = null;
            this.posZ = 0.0;
            this.posY = 0.0;
            this.posX = 0.0;
            this.yaw = 0.0f;
            this.pitch = 0.0f;
            NoPacketTP.mc.player.capabilities.isFlying = false;
            NoPacketTP.mc.player.capabilities.setFlySpeed(500f);
            NoPacketTP.mc.player.noClip = false;
            NoPacketTP.mc.player.motionZ = 0.0;
            NoPacketTP.mc.player.motionY = 0.0;
            NoPacketTP.mc.player.motionX = 0.0;
            if (this.isRidingEntity) {
                NoPacketTP.mc.player.startRiding(this.ridingEntity, true);
            }
        }
    }
}
